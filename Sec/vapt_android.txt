
Android Application VAPT

=> Static Analysis Tools
- MobSF -> Automated scanner-> Find vulnerabilities automatically
- Apktool -> Decode APK -> Analyze manifest, smali, structure
- JADX -> Decompile APK -> Analyze Java code, secrets, logic
- dex2jar -> Convert dex to jar -> Alternative decompile method
- strings -> Extract text from binaries -> Find keys in native libraries

=> Dynamic Analysis Tools
- Frida -> Hook app, bypass protections
- Objection -> Easy Frida automation
- BurpSuite -> Intercept and modify API traffic
- Drozer -> Test exported components
- ADB -> Control device and access files
- Logcat -> Monitor app logs

=> Setup & Environment Preparation
- Test Environment
    - Rooted Android device available
    - Emulator available
    - Adb configured
    - Burp Suite configured
    - Proxy installed on device
    - CA certificate installed
    - Frida installed and working
    - Objection installed
- Verify:
    - adb devices
    - frida-ps -U

=> Root Detection Bypass
- Prerequisites: MEmu Emulator (Rooted), Frida, ADB
- Check connection:
    - adb devices
    - adb connect 127.0.0.1:21503
- Deploy Frida server on MEmu:
    - Get MEmu Architecture (commonly x86_64): adb shell getprop ro.product.cpu.abi
    - Download frida-server binary for emulator's architecture
    - Push downloaded files to the emulator: adb push frida-server /data/local/tmp
- Run Frida server:
    - adb shell
    - cd /data/local/tmp
    - chmod 755 frida-server
    - ./frida-server &
- Verify the installation: frida-ps -U
- Check for Root Detection Mechanism in code with JADX
    - Keywords: root, isRoot, checkRoot, superuser, su, RootBeer
    - Path: /system/bin/su, /system/xbin/su, /sbin/su, /vendor/bin/su, /system/app/Superuser.apk, /system/app/SuperSU.apk, /system/app/Magisk.apk
    - Command execution checks, Apps run commands: which su, su -c, busybox, id, whoami
    - File existence checks: File.exists, new File(, canExecute, canRead. Example: new File("/system/xbin/su").exists()
    - Package checks (Superuser apps): eu.chainfire.supersu, com.topjohnwu.magisk, com.noshufou.android.su, com.koushikdutta.superuser
    - Root detection libraries: RootBeer, rootbeer, com.scottyab.rootbeer
    - SafetyNet / Play Integrity checks: SafetyNet, PlayIntegrity, ctsProfileMatch, basicIntegrity, MEETS_DEVICE_INTEGRITY
- Inject Script: frida -U -f com.ril.rposcentral -l root_bypass.js

=> SSL Pinning Bypass
- Prerequisites: Frida, MEmu
- Start Frida Server on Emulator:
    - Copy frida-server to emulator: adb push frida-server /data/local/tmp/
    - Give permission:
        - adb shell
        - su
        - chmod 755 /data/local/tmp/frida-server
    - Run frida-server: /data/local/tmp/frida-server &
    - Verify connection: frida-ps -U
- Configure Burp Suite Proxy Listener
    - Open Burp Suite -> Proxy -> Proxy Settings
    - Add -> Bind to port: 8080 -> All interfaces
- Connect Android device to same WiFi
- Configure Proxy on MEmu Emulator
    - Settings -> WiFi -> Modify Network -> Advanced Options
    - Proxy -> Manual -> hostname: <ip> and Port: 8080
- Install Burp CA Certificate on Emulator
    - Open browser: http://burp
    - Download certificate: cacert.der -> Rename to -> cacert.cer
    - Install certificate: Settings -> Security -> Encryption & credentials -> Install certificate -> CA Certificate -> Select cacert.cer
- Verify Proxy is Working:
    - Open browser in emulator and visit: http://example.com
    - You should see traffic in: Burp → Proxy → HTTP History
- Run SSL Pinning Bypass Script using Frida:
    - Launch app with Frida: frida -U -f com.package.name -l ssl_bypass.js --no-pause
    - Or attach to running app: frida -U -n com.package.name -l ssl_bypass.js
- Confirm SSL Pinning Bypass:
    - If bypass is successful: HTTPS traffic will appear in Burp
    - No SSL errors in app
    - Requests visible in Burp HTTP History

---

=> Android Pentesting Checklist/Test Cases

- Reconnaissance & Information Gathering
    - APK Basic Information
        - Extract using:
            - aapt dump badging app.apk
        - Check:
            - App Name
            - Package Name
            - Version Name
            - Version Code
            - Min SDK Version
            - Target SDK Version
            - Permissions
            - Launch Activity
    - Signing Certificate Analysis
        - Check: keytool -printcert -jarfile app.apk
        - Verify:
            - Debug certificate used
            - Production certificate used
        - Risk: Debug certificate allows tampering.
    - Identify Attack Surface
        - Document all:
            - Activities
            - Services
            - Broadcast Receivers
            - Content Providers
            - Deep links
            - Network endpoints
            - APIs used
            - Third-party services
        - Tools:
            - MobSF
            - apktool
            - jadx
- Static Analysis
    - AndroidManifest.xml Security Analysis
        - Extract: apktool d app.apk
        - Exported Activities
            - Check: android:exported="true"
            - Test:
                - Launch activity without authentication: adb shell am start -n package/.Activity
                - Access hidden functionality
                - Access admin activity
        - Exported Services
            - Test:
                - Start service externally
                - Abuse service functionality
        - Exported Broadcast Receivers
            - Test: adb shell am broadcast -a ACTION_NAME
            - Check:
                - Trigger sensitive operations
                - Bypass authentication
        - Exported Content Providers
            - Test: adb shell content query --uri content://package.provider/
            - Check:
                - Unauthorized read
                - Unauthorized write
    - Permission Analysis
        - Check dangerous permissions:
            - READ_EXTERNAL_STORAGE
            - WRITE_EXTERNAL_STORAGE
            - READ_CONTACTS
            - CAMERA
            - RECORD_AUDIO
            - READ_SMS
            - ACCESS_FINE_LOCATION
        - Verify necessity.
    - Debuggable Flag
        - Check: android:debuggable="true"
        - Risk: Full compromise possible
    - Backup Enabled
        - Check: android:allowBackup="true"
        - Test: adb backup
        - Risk: Sensitive data extraction
    - Cleartext Traffic Allowed
        - Check: android:usesCleartextTraffic="true"
        - Risk: MITM possible
- Hardcoded Secrets Testing
    - Search source code for:
        - API keys
        - Tokens
        - Passwords
        - Encryption keys
        - Bearer tokens
        - Firebase keys
        - AWS keys
    - Search keywords:
        - password
        - token
        - secret
        - key
        - authorization
        - bearer
        - firebase
- Reverse Engineering Protections
    - Check:
        - Obfuscation enabled
        - ProGuard enabled
        - R8 enabled
    - Risk if missing: Easy reverse engineering
- Local Storage Testing
    - Path: /data/data/package/
    - Shared Preferences
        - Check: /data/data/package/shared_prefs/
        - Test:
            - Tokens stored plaintext
            - Credentials stored
            - Sensitive data stored
    - SQLite Database
        - Check: /data/data/package/databases/
        - Test:
            - Plaintext credentials
            - Sensitive user data
    - Internal Storage
        - Check: /data/data/package/files/
        - Test:
            - Sensitive files present
    - External Storage
        - Check: /sdcard/
        - Test:
            - Sensitive data stored
            - Public access possible
    - Cache Storage
        - Check: /data/data/package/cache/
        - Test:
            - Sensitive data cached
- Authentication Testing
    - Test cases:
        - Authentication bypass
        - Login without credentials
        - Weak password policy
        - Brute force protection missing
        - Account lockout missing
        - OTP bypass
        - Token reuse
        - Session fixation
        - Session not invalidated after logout
        - Biometric bypass
- Authorization Testing
    - Test:
        - Horizontal privilege escalation
        - Vertical privilege escalation
        - Access other user's data
        - Access admin functionality
        - IDOR via API
    - Example: user_id=123 -> 124
- Network Communication Testing
    - Intercept using:
        - Burp Suite
        - mitmproxy
    - Insecure Communication
        - Check:
            - HTTP used
            - Sensitive data in HTTP
    - Sensitive Data Exposure
        - Check exposure of:
            - Passwords
            - Tokens
            - Session ID
            - Personal data
    - SSL Pinning Testing
        - Check:
            - SSL pinning implemented
            - Attempt bypass using Frida
    - Certificate Validation
        - Check:
            - Improper validation
            - Accepts invalid certificates
- API Security Testing
    - Test:
        - IDOR
        - SQL Injection
        - Auth bypass
        - Rate limit bypass
        - Business logic bypass
- WebView Testing
    - Check: setJavaScriptEnabled(true)
    - Test:
        - XSS
        - Load arbitrary URLs
        - Access local files
    - Check: setAllowFileAccess(true)
    - Risk: Local file theft
- Deep Link Testing
    - Check manifest for: android.intent.action.VIEW
    - Test: adb shell am start -a android.intent.action.VIEW -d "app://..."
    - Test:
        - Authentication bypass
        - Access restricted pages
- Intent Security Testing
    - Test:
        - Intent injection
        - Intent redirection
- Content Provider Testing
    - Test: adb shell content query --uri content://
    - Check:
        - Unauthorized read
        - Unauthorized write
- Dynamic Analysis
    - Monitor runtime behavior.
    - Tools:
        - Frida
        - Objection
    - Check:
        - Runtime manipulation possible
        - Token extraction possible
- Log Analysis
    - Check using: adb logcat
    - Check exposure of:
        - Passwords
        - Tokens
        - Sensitive data
- Cryptography Testing
    - Check:
        - Weak encryption
        - Hardcoded keys
        - ECB mode used
        - Custom crypto
- Root Detection Testing
    - Check if implemented.
    - Test bypass using:
        - Frida
        - Magisk
        - Objection
- Certificate Pinning Bypass
    - Test bypass
- Emulator Detection Testing
    - Check:
        - Emulator detection present
        - Attempt bypass
- Code Tampering Testing
    - Test:
        - Modify APK
        - Reinstall
    - Check if detected.
- Runtime Protections
    - Check presence of:
        - Root detection
        - Emulator detection
        - Debug detection
        - Frida detection
- Clipboard Testing
    - Test:
        - Sensitive data copied to clipboard
- Screenshot Protection
    - Check if enabled: FLAG_SECURE
- Firebase Security Testing
    - Check:
        - Firebase database exposed
        - Unauthorized access possible
- Third-party Library Testing
    - Check:
        - Outdated libraries
        - Vulnerable dependencies
- File System Testing
    - Test:
        - Path traversal
        - Arbitrary file access
- Overlay Attack Testing
    - Check:
        - Tapjacking possible
        - Overlay attack possible
- Business Logic Testing
    - Test:
        - Payment bypass
        - Subscription bypass
        - Account takeover
        - Workflow bypass
- Runtime Exploitation Testing
    - Using Frida / Objection:
        - Test:
            - Bypass root detection
            - Extract tokens
            - Modify app behavior
- MASVS Compliance Verification
    - Verify:
        - MASVS-STORAGE
        - MASVS-NETWORK
        - MASVS-CRYPTO
        - MASVS-AUTH
        - MASVS-PLATFORM
        - MASVS-CODE
- Advanced Exploitation Testing
    - Test:
        - SSL pinning bypass
        - Runtime hooking
        - Logic manipulation
